<div class="list_candidats">
<div class="ui grid">
    {{#each userStages}}

        <div class="row stage-{{stageId}} candidate-box-wrap candidate-id-{{candidateId}} role-id-{{jobId}} client-id-{{lookup (lookup ../../../jobsMap jobId) 'client'}}">
            <div class="two wide column candidate-picture {{stageToCss stageId}}">
                <div class="center-vertical-wrap">
                    <div class="center-vertical">
                        <a href="/candidate/{{candidateId}}">
                            <img class="ui small circular image color {{stageToCss stageId}}" src="{{ lookup (lookup ../candidatesMap candidateId) 'picture'}}" alt="" onerror="this.src='/assets/img/client-logo.png'"/>
                        </a>
                    </div>
                </div>
            </div>
            <div class="four wide column candidate-name {{stageToCss stageId}}">
                <p><b>{{lookup (lookup ../candidatesMap candidateId) 'fullname'}}</b></p>
                <p>{{lookup (lookup ../candidatesMap candidateId) 'headline'}}</p>
                <!-- <p><b>{{current}}</b></p> -->
                <p>{{lookup (lookup ../candidatesMap candidateId) 'location'}}</p>
            </div>
            <div class="four wide column candidate-details {{stageToCss stageId}}">
                <p><b>CV:</b>
                    {{#if (lookup (lookup ../candidatesMap candidateId) 'cvDocumentLink') }}
                        <a href="{{cvDocumentLink}}" target="_blank">view</a>
                    {{else}}
                        N/A
                {{/if}}
                </p>
                <p><b>Email:</b>
                    {{#if (lookup (lookup (lookup ../candidatesMap candidateId) 'contacts') 'email') }}
                        {{lookup (lookup (lookup ../candidatesMap candidateId) 'contacts') 'email'}}
                    {{else}}
                        N/A
                    {{/if}}
                </p>
                <p><b>Phone:</b>
                    {{#if (lookup (lookup (lookup ../candidatesMap candidateId) 'contacts') 'phone') }}
                        {{lookup (lookup (lookup ../candidatesMap candidateId) 'contacts') 'phone'}}
                    {{else}}
                        N/A
                    {{/if}}
                </p>
                <!--
                <p><b>Salary:</b>
                {{#if info.sexpected}}
                    {{info.sexpected}}
                {{else}}
                    N/A
                {{/if}}
                </p>
                -->
                <!-- action buttons -->
                <div class="stage-actions-wrap">
                    <div class="ui icon buttons stage-actions">

                        <button class="ui button icon small regress
                        {{#unless (stagePrev stageId ../stages)}}
                            disabled
                        {{/unless}}
                        {{#if (equal stageId 6)}}
                        disabled
                        {{/if}}
                        " data-content="Regress" value="regress"><i class="icon custom logo-left"></i></button>
                        <button class="ui button icon small reject
                        {{#if (equal stageId 6)}}
                        disabled
                        {{/if}}
                        " data-content="Reject" value="reject"><i class="icon custom logo-center"></i></button>
                        <button class="ui button icon small advance
                        {{#unless (stageNext stageId ../stages)}}
                            disabled
                        {{/unless}}
                        " data-content="Advance" value="advance"><i class="icon custom logo-right"></i></button>
                        <button class="ui button icon small delete" data-content="Delete" value="delete"><i class="trash icon"></i></button>
                        <button class="ui button icon small disabled contact" data-content="Contact" value="contact"><i class="bug icon"></i></button>
                        <button class="ui button icon small disabled note" data-content="Note" value="note"><i class="sticky note icon"></i></button>
                        <!-- action forms -->

                        <form class="delete" action="/status/delete" method="POST">
                            <input type="hidden" name="id" value="{{_id}}">
                            <input type="hidden" name="redirect_url" value="{{../request.url.path}}">
                        </form>

                        <form class="regress" action="/status/edit" method="POST">
                            <input type="hidden" name="id" value="{{_id}}">
                            <input type="hidden" name="stageId" value="{{stagePrev stageId ../stages}}">
                            <input type="hidden" name="redirect_url" value="{{../request.url.path}}">
                        </form>
                        <form class="reject" action="/status/edit" method="POST">
                            <input type="hidden" name="id" value="{{_id}}">
                            <input type="hidden" name="stageId" value="6">
                            <input type="hidden" name="redirect_url" value="{{../request.url.path}}">
                        </form>

                        <form class="advance" action="/status/edit" method="POST">
                            <input type="hidden" name="id" value="{{_id}}">
                            <input type="hidden" name="stageId" value="{{stageNext stageId ../stages}}">
                            <input type="hidden" name="redirect_url" value="{{../request.url.path}}">
                        </form>

                        <!-- action modals -->

                        <div class="ui modal delete">
                            <i class="close icon"></i>
                            <div class="header">
                                Delete Application
                            </div>
                            <div class="content">
                                <p>Are you sure you want to delete {{fullname}}'s application? </p>
                            </div>
                            <div class="actions">
                                <div class="ui buttons">
                                    <button class="ui button cancel">Cancel</button>
                                    <div class="or"></div>
                                    <button class="ui negative button action">Delete</button>
                                </div>
                            </div>
                        </div>
                        <div class="ui modal regress">
                            <i class="close icon"></i>
                            <div class="header">
                                Regress Application
                            </div>
                            <div class="content">
                                <!-- @TODO: calculate maybe what the previous stage is -->
                                <p> Are you sure you want to put this applicaiton into the previous stage?</p>
                            </div>
                            <div class="actions">
                                <div class="ui buttons">
                                    <button class="ui button cancel">Cancel</button>
                                    <div class="or"></div>
                                    <button class="ui negative button action">Regress</button>
                                </div>
                            </div>
                        </div>
                        <div class="ui modal reject">
                            <i class="close icon"></i>
                            <div class="header">
                                Reject Application
                            </div>
                            <div class="content">
                                <p>Are you sure you want to reject {{fullname}}'s application? </p>
                            </div>
                            <div class="actions">
                                <div class="ui buttons">
                                    <button class="ui button cancel">Cancel</button>
                                    <div class="or"></div>
                                    <button class="ui button negative action">Reject</button>
                                </div>
                            </div>
                        </div>
                        <div class="ui modal advance">
                            <i class="close icon"></i>
                            <div class="header">
                                Advance Application
                            </div>
                            <div class="content">
                                <p>Are you sure you want to advance this application?</p>
                            </div>
                            <div class="actions">
                                <div class="ui buttons">
                                    <button class="ui button cancel">Cancel</button>
                                    <div class="or"></div>
                                    <button class="ui positive button action">Advance</button>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

            </div>

            <div class="two wide column client">
                <div class="center-vertical-wrap">
                    <div class="center-vertical">
                        <a href="/clients/{{lookup (lookup ../jobsMap jobId) 'client'}}">
                            <img class="ui small image" src="{{lookup (lookup ../clientsMap (lookup (lookup ../jobsMap jobId) "client") ) "logoUrl" }}" alt="" onerror="this.src='/assets/img/client-logo.png'"/>
                        </a>
                    </div>
                </div>
            </div>
            <div class="four wide column role">
                <p><b>{{lookup (lookup ../clientsMap (lookup (lookup ../jobsMap jobId) "client") ) "name" }}</b></p>
                <a href="/jobs/{{jobId}}"><p>{{lookup (lookup ../jobsMap jobId) "title" }}</p></a>
                <p>{{lookup (lookup ../jobsMap jobId) "salary" }}</p>
                <p>{{lookup (lookup (lookup ../jobsMap jobId) "address") "city" }}, 
                        {{ lookup (lookup ../countries (lookup (lookup (lookup ../jobsMap jobIf) "address") "countryID" )) "label" }}</p>
            </div>
        </div>

    {{/each}}
    </div>
</div>